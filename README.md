# 高配当株分析システム v2.1 — Dividend Stock Analyzer

## 概要

公認会計士の専門知識に基づき、日本株の投資適格性を8つの財務指標で評価する静的Webアプリケーション。  
**v2.1** では株探（kabutan.jp）からリアルタイム財務データを取得する機能を実装し、任意の4桁銘柄コードで分析が可能になりました。

## 主要機能

### ✅ 実装済み機能

| 機能 | 説明 |
|------|------|
| **株探リアルタイム取得** | kabutan.jp からCORSプロキシ経由でHTML取得、DOMParserで3テーブル（業績・CF・財務）を統合解析 |
| **3段階フォールバック** | 株探(Online) → LocalStorageキャッシュ(24h) → 内蔵サンプルデータ(6銘柄) |
| **銘柄コード検索** | 4桁数字バリデーション（`/^\d{4}$/`）、Enterキー・クイック選択対応 |
| **8指標テーブル** | 売上高・営業利益率・EPS・営業CF・1株配当・配当性向・自己資本比率・現金等の年度別テーブル |
| **投資適格性スコア** | 100点満点（成長性30 / 収益性20 / 配当安定性30 / 財務健全性20）、A+〜Cランク |
| **リスク警告** | 減配リスク(配当性向>80%)、本業赤字(営業利益率<0)、財務脆弱(自己資本比率<30%)、資金繰り悪化(営業CF3年連続赤字)、利益超過配当 |
| **キャッシュシステム** | LocalStorage 24h有効・最大30銘柄・全削除ボタン |
| **レスポンシブデザイン** | PC:4列/タブレット:2列/モバイル:1列+横スクロールテーブル |

### 🔄 v2.0 → v2.1 変更点

- **データソース変更**: Yahoo!ファイナンス(SPA/JSレンダリングで取得不可) → **株探 kabutan.jp**(SSRでHTML解析可能)
- **HTMLパーサー全面書き換え**: 株探の実HTMLテーブル構造に完全対応
  - 業績テーブル: `.fin_year_t0_d.fin_year_result_d table` (売上高・営業益・EPS・配当)
  - CFテーブル: `#cashflow_title` の後続テーブル (営業CF・現金等残高)
  - 財務テーブル: `#zaimu_title` の後続テーブル (自己資本比率)
- **デフォルトデータソースを「株探(リアルタイム)」に変更**: サンプルデータではなくオンラインがデフォルト
- **DATA_SOURCE定数の整理**: `YAHOO` → `ONLINE` に改名、UIラベルも統一

## ファイル構成

```
index.html   — メインHTML（検索フォーム・カード・テーブル・警告）
style.css    — スタイルシート（CSS変数・レスポンシブ・ステータスカラー）
app.js       — アプリケーションロジック（全12セクション）
README.md    — 本ドキュメント
```

## app.js アーキテクチャ（12セクション）

| # | セクション | 内容 |
|---|-----------|------|
| 0 | 定数・設定 | DATA_SOURCE, PROXY_LIST, KABUTAN_URLS, CACHE_CONFIG |
| 1 | サンプルデータ | stocksData（6銘柄×9年分） |
| 2 | 純粋関数 | isIncreasing, calculateAverage, assess* 等 |
| 3 | スコアリング | calculateInvestmentScore (100点), getScoreRank |
| 4 | リスク警告 | detectRisks（5種類の警告） |
| 5 | 数値フォーマット | formatMillions, formatPercent, formatYen, calculateChange |
| 6 | キャッシュ | saveToCache, getFromCache, clearAllCache |
| 7 | **株探スクレイピング** | fetchViaProxy, parseFinancialValue, parseKabutanHTML, extractPerformanceTable, extractCashFlowTable, extractFinancialTable |
| 8 | データ抽象化 | fetchFinancialData, handleFallback |
| 9 | UI描画 | renderStockInfo, renderSummaryCards, renderRiskWarnings, renderScoreDetails, renderDataTable |
| 10 | ステータス表示 | showLoading, showMessage, updateSourceBadge |
| 11 | メイン制御 | analyzeStock（統合分析エンジン） |
| 12 | 初期化 | renderQuickButtons, initEventListeners, init |

## スコアリングロジック詳細

| カテゴリ | 配点 | 条件 |
|---------|------|------|
| **成長性** | 30点 | 売上高3年連続増加(10) + EPS3年連続増加(10) + 営業CF3年連続黒字(10) |
| **収益性** | 20点 | 直近3年平均営業利益率≥10%(20) |
| **配当安定性** | 30点 | 1株配当3年連続維持/増加(15) + 配当性向30-50%範囲内(15) |
| **財務健全性** | 20点 | 自己資本比率≥40%(10) + 現金等前年比増加(10) |

**ランク**: A+(90-100) / A(70-89) / B(50-69) / C(0-49)

## 内蔵サンプル銘柄

| コード | 銘柄名 | セクター |
|--------|--------|---------|
| 9843 | ニトリホールディングス | 小売業 |
| 8591 | オリックス | その他金融業 |
| 8766 | 東京海上ホールディングス | 保険業 |
| 2914 | 日本たばこ産業 | 食料品 |
| 9433 | KDDI | 情報・通信業 |
| 4502 | 武田薬品工業 | 医薬品 |

## エントリーURI

| パス | 説明 |
|------|------|
| `index.html` | メインページ（唯一のエントリーポイント） |

## 動作確認手順

1. `index.html` をブラウザで開く
2. 初期画面でニトリHD（9843）のサンプルデータ分析結果が表示される
3. **サンプルデータで確認**: データソースを「📦 サンプルデータ」にし、クイック選択ボタン（9843, 8591 等）をクリック
4. **リアルタイム取得で確認**: データソースを「🌐 株探 kabutan.jp」にし、任意の4桁銘柄コード（例: 7203 トヨタ）を入力して「分析開始」
5. スコア・リスク警告・テーブルが正しく表示されることを確認
6. 🔄 ボタンで強制再取得ができることを確認

## 技術スタック

- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript (ES2020+)
- **データソース**: kabutan.jp（CORSプロキシ: codetabs.com / allorigins.win 経由）
- **キャッシュ**: LocalStorage (24h TTL)
- **フォント**: Google Fonts (Noto Sans JP, Inter)
- **アイコン**: Font Awesome 6.4.0
- **サードパーティ依存**: なし（CDNライブラリのみ）

## 制約事項・注意点

- CORSプロキシ（allorigins.win）の可用性に依存します。プロキシがダウンしている場合、キャッシュまたはサンプルデータにフォールバックします
- 株探のHTML構造が変更された場合、パーサーの更新が必要になる可能性があります
- 本システムの分析結果は情報提供目的であり、投資助言ではありません
- 銘柄によっては財務テーブルの一部（CF・財務）が取得できない場合があります（その場合は0として処理）

## 推奨次ステップ

1. **株探HTMLパーサーの堅牢性向上**: テーブル検出のフォールバックパターンを追加
2. **複数銘柄比較機能**: 2〜3銘柄の横並び比較
3. **チャート可視化**: Chart.js で売上・EPS・配当の折れ線グラフ表示
4. **ポートフォリオ機能**: お気に入り銘柄の一括管理・通知
5. **セクター別フィルタリング**: 業種ごとの分析比較
